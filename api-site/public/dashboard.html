<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="./assents/icon/istockphoto-503427908-1024x1024.jpg">
    <link rel="stylesheet" href="./css/dashboard.css">
    <title>KEEP RUNNING</title>
</head>

<body onload="obterDadosGrafico()">
    <div class="fundo">
        <div class="menulateral">
            <ul>

                <li>
                    <a href="perfil.html">
                        <span class="icon">
                            <ion-icon name="person-outline"></ion-icon>
                        </span>
                        <span class="menu">Perfil</span>
                    </a>
                </li>

                <li style="background-color: white; border-radius: 10px">
                    <a href="dashboard.html" style="color: #000000">
                        <span class="icon">
                            <ion-icon name="stats-chart-outline"></ion-icon>
                        </span>
                        <span class="menu">Gráficos</span>
                    </a>
                </li>

                <li>
                    <a href="login.html">
                        <span class="icon">
                            <ion-icon name="log-out-outline"></ion-icon>
                        </span>
                        <span class="menu">Sair</span>
                    </a>
                </li>

            </ul>
            <div id="img_logo">
                <img src="./assents/icon/istockphoto-503427908-1024x1024.jpg" alt=""
                    style="width: 50%; display: flex; align-items: center; margin-left: 20%; border-radius: 40px;">
            </div>
        </div>

        <div class="dashboard">
            <div class="container">
                <div id="caixa">
                    <div class="grafico">
                        <div id="legenda">confira os seus treinos!</div>
                        <div id="grafics">

                            <table id="registros">
                                <tr>
                                    <th>duração</th>
                                    <th>distância</th>
                                    <th>ritmo</th>
                                    <th>calorias</th>
                                </tr>                                
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
</body>

</html>

<script>
    var captura = [];
    function obterDadosGrafico(idtreino) {
        var fk_usuarioVar = Number(sessionStorage.getItem('ID_USUARIO'));

        /* if (proximaAtualizacao != undefined) {
            clearTimeout(proximaAtualizacao);
        } */

        fetch(`/medidas/ultimas/${idtreino}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    resposta.reverse();

                    plotarGrafico(resposta, idtreino);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }
    function plotarGrafico(resposta, idtreino) {
        console.log('iniciando plotagem do ranking...');

        // Criando estrutura para plotar gráfico - labels
        /* var dados = {
            datasets: [{
                duracao: [],
                distancia: [],
                ritmo: [],
                calorias: []
            }]
        };

        //lista de dados para teste
        var lista = [resposta.length + 1]; */

        // Criando estrutura para plotar gráfico - dados

        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)

        // Inserindo valores recebidos em estrutura para plotar o gráfico
        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];

            /* dados.datasets[i].duracao.push(registro.duracao);
            dados.datasets[i].distancia.push(registro.distancia);
            dados.datasets[i].ritmo.push(registro.ritmo);
            dados.datasets[i].calorias.push(registro.calorias);

            //inserindo um objeto dados dentro da lista criada lá em cima(teste)
            lista[i].push(dados); */

            /* possível criação de class para atribuir e utilizar o valor */


            /*         console.log('----------------------------------------------')
                    console.log('O ranking será plotado com os respectivos valores:')
                    console.log('Labels:')
                    console.log(labels)
                    console.log('Dados:')
                    console.log(dados.datasets)
                    console.log('----------------------------------------------') */

            // Criando estrutura para plotar gráfico - config
            registros.innerHTML += `<tr>
                                        <th>${registro.duracao}</th>
                                        <th>${registro.distancia}</th>
                                        <th>${registro.ritmo}</th>
                                        <th>${registro.calorias}</th>
                                   </tr>`;

        }
    }
</script>